<!DOCTYPE html>
<html lang="zh-Hans">

<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="./style.css">
    <title>注册账号</title>

</head>

<body>
    <main class="main">
        <img src="./img/p3.jpg">
        <div class="form-wrapper">
            <h1>嘿！听说你也喜欢狗狗！<br>
                欢迎加入我们！</h1>
            <form class="signUpForm" id="signUpForm">
                <div class="information">
                    <div class="first-row">
                        <div class="em">
                            <label>邮箱</label>
                            <input type="text" name="email">
                            <span class="error"></span>
                        </div>
                        <div class="un">
                            <label>昵称</label>
                            <input type="text" name="username">
                            <span class="error"></span>
                        </div>
                    </div>

                    <div class="second-row">
                        <div class="pw">
                            <label>密码</label>
                            <input type="password" name="password">
                            <span class="error"></span>
                        </div>
                        <div class="pwc">
                            <label>确认密码</label>
                            <input type="password" name="password_confirmation">
                            <span class="error"></span>
                        </div>
                    </div>
                    <div class="third-row">
                        <label>性别</label>
                        <input type="radio" name="gender">
                    </div>
                </div>
                <div class="last-row">
                    <button class="back">返回</button>
                    <input class="sign_up" type="submit" value="注册">
                </div>
            </form>
        </div>
    </main>
    <footer></footer>
    <script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>
    <script>
        let $form = $('#signUpForm')
        let hash = {}
        $form.on('submit', (e) => {
            e.preventDefault();
            let need = ['email', 'password', 'password_confirmation']
            need.forEach((name) => {
                let value = $form.find(`[name=${name}]`).val()
                hash[name] = value
            })
            $form.find('.error').each((index, span) => {
                $(span).text('')
            })
            if (hash['email'] === '') {
                $form.find(`[name="email"]`).siblings('.error').text('邮箱不能为空')
                return
            }
            if (hash['password'] === '') {
                $form.find(`[name="password"]`).siblings('.error').text('密码不能为空')
                return
            }
            if (hash['password_confirmation'] === '') {
                $form.find(`[name="password_confirmation"]`).siblings('.error').text('请确认密码')
                return
            }
            if (hash['password_confirmation'] !== hash['password']) {
                $form.find(`[name="password_confirmation"]`).siblings('.error').text('两次密码不一致')
                return
            }
            $.post('/sign_up', hash).then((response) => {
                window.location.href('/sign_in')
            }, (request) => {
                if (request.responseText === 'email in use') {
                    alert('邮箱已存在')
                }
                let { errors } = request.responseJSON
                if (errors.email && errors.email === 'invalid') {
                    $form.find(`[name="email"]`).siblings('.error').text('邮箱格式错误')
                }


            })
        })
    </script>
</body>

</html>